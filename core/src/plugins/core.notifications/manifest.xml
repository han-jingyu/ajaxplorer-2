<?xml version="1.0" encoding="UTF-8"?>
<ajxp_plugin label="CONF_MESSAGE[Notification Center]" description="CONF_MESSAGE[Handle users watches and notification]" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:noNamespaceSchemaLocation="file:../core.ajaxplorer/ajxp_registry.xsd">
    <class_definition classname="AJXP_NotificationCenter" filename="plugins/core.notifications/class.AJXP_NotificationCenter.php"/>
    <client_settings>
        <resources>
            <i18n namespace="notification.tpl.short" path="plugins/core.notifications/templates/short"/>
            <i18n namespace="notification.tpl.long" path="plugins/core.notifications/templates/long"/>
            <i18n namespace="notification.tpl.group" path="plugins/core.notifications/templates/group"/>
            <i18n namespace="notification_center" path="plugins/core.notifications/res/i18n"/>
            <css file="plugins/core.notifications/res/css/notification_center.css"/>
            <img_library alias="notification_center" path="plugins/core.notifications/res/img"/>
        </resources>
    </client_settings>
    <server_settings>
        <global_param description="CONF_MESSAGE[Post the notification in a temporary queue. You must set up the scheduler accordingly to make sure the queue is then consumed on a regularly basis.]" label="CONF_MESSAGE[Queue notifications]" name="USE_QUEUE" type="boolean" default="false"/>
    </server_settings>
    <registry_contributions>
        <actions>
            <action name="consume_notification_queue">
                <processing>
                    <serverCallback methodName="consumeQueue"/>
                </processing>
            </action>
            <action name="get_my_feed">
                <gui text="notification_center.1" title="notification_center.2" src="notification_center/ICON_SIZE/feed.png" accessKey="" hasAccessKey="false">
             		<context selection="false" dir="" recycle="true" actionBar="false" actionBarGroup="utils" contextMenu="false" infoPanel="false" ajxpWidgets="UserWidget::logging_string"/>
                </gui>
                <processing>
                    <clientCallback dialogOpenForm="user_feed" dialogOkButtonOnly="true" prepareModal="true">
                        <dialogOnOpen><![CDATA[
                             var conn = new Connexion();
                             conn.setParameters({get_action:"get_my_feed"});
                             conn.onComplete = function(transport){
                                modal.getForm().down("div#feed_content").update(transport.responseText);
                             };
                             conn.sendAsync();
                        ]]></dialogOnOpen>
                        <dialogOnComplete><![CDATA[
                             hideLightBox();
                        ]]></dialogOnComplete>
                    </clientCallback>
                    <clientForm id="user_feed"><![CDATA[
                        <div id="user_feed" box_padding="0" box_width="320">
                            <div id="feed_content" style="width: 320px;height: 320px;overflow: auto;"></div>
                        </div>
                    ]]></clientForm>
                    <serverCallback methodName="loadUserFeed"/>
                </processing>
            </action>
        </actions>
        <hooks>
            <serverCallback methodName="persistChangeHookToFeed" hookName="node.change" defer="true"/>
        </hooks>
    </registry_contributions>
</ajxp_plugin>